<!DOCTYPE html>
<html lang="en">
{% extends './admin_sidebar.html' %}
{% block content %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin | MCQ Management</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --accent-color: #4cc9f0;
            --dark-color: #1e1e2d;
            --light-color: #f8f9fa;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --danger-color: #f44336;
            --gray-color: #6c757d;
            --border-radius: 10px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f7fb;
            color: #333;
            overflow-x: hidden;
        }

        /* Main Content */
        .main-content {
            margin-left: 260px;
            padding: 20px;
            transition: var(--transition);
        }

        /* Topbar */
        .topbar {
            height: 70px;
            background: white;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 25px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .topbar-left h3 {
            font-weight: 600;
            color: var(--dark-color);
            margin: 0;
        }

        .topbar-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .search-bar {
            position: relative;
        }

        .search-bar input {
            padding: 10px 15px 10px 40px;
            border-radius: 50px;
            border: 1px solid #e0e0e0;
            width: 250px;
            transition: var(--transition);
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .search-bar i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-color);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* Page Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .page-title h1 {
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 5px;
        }

        .page-title p {
            color: var(--gray-color);
            margin: 0;
        }

        /* Stats Cards */
        .stats-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            height: 100%;
            display: flex;
            align-items: center;
        }

        .stats-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }

        .stats-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 22px;
        }

        .stats-card.blue .stats-icon {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }

        .stats-card.green .stats-icon {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success-color);
        }

        .stats-card.orange .stats-icon {
            background-color: rgba(255, 152, 0, 0.1);
            color: var(--warning-color);
        }

        .stats-card.purple .stats-icon {
            background-color: rgba(157, 80, 187, 0.1);
            color: #9d50bb;
        }

        .stats-content h3 {
            font-weight: 700;
            color: var(--dark-color);
            margin: 0;
            line-height: 1;
        }

        .stats-content p {
            color: var(--gray-color);
            font-size: 14px;
            margin: 5px 0 0;
        }

        /* MCQ Table Container */
        .table-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-top: 20px;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .table-header h5 {
            font-weight: 600;
            color: var(--dark-color);
            margin: 0;
        }

        .table-actions {
            display: flex;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border: none;
            padding: 8px 20px;
            border-radius: 8px;
            font-weight: 500;
            transition: var(--transition);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }

        /* MCQ Table */
        .mcq-table {
            border-collapse: separate;
            border-spacing: 0;
            width: 100%;
        }

        .mcq-table thead th {
            border: none;
            background-color: #f8f9fa;
            color: var(--gray-color);
            font-weight: 600;
            padding: 15px;
            border-bottom: 2px solid #e9ecef;
            text-transform: uppercase;
            font-size: 13px;
            letter-spacing: 0.5px;
        }

        .mcq-table tbody tr {
            transition: var(--transition);
            border-bottom: 1px solid #f1f1f1;
        }

        .mcq-table tbody tr:hover {
            background-color: rgba(67, 97, 238, 0.05);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }

        .mcq-table tbody td {
            padding: 15px;
            vertical-align: middle;
        }

        .mcq-question {
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .mcq-options {
            font-size: 14px;
            color: var(--gray-color);
        }

        .mcq-option {
            display: flex;
            align-items: flex-start;
            margin-bottom: 5px;
            padding: 5px 0;
        }

        .option-letter {
            display: inline-block;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            background: #f1f3f4;
            text-align: center;
            line-height: 24px;
            font-weight: 600;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .option-letter.correct {
            background: var(--success-color);
            color: white;
        }

        .mcq-course {
            font-weight: 500;
            color: var(--dark-color);
            margin-bottom: 3px;
        }

        .mcq-course-info {
            font-size: 13px;
            color: var(--gray-color);
        }

        .mcq-created {
            font-size: 13px;
            color: var(--gray-color);
        }

        .badge-status {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-active {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success-color);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-action {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-edit {
            background-color: rgba(255, 152, 0, 0.1);
            color: var(--warning-color);
            border: 1px solid rgba(255, 152, 0, 0.2);
        }

        .btn-edit:hover {
            background-color: var(--warning-color);
            color: white;
            border-color: var(--warning-color);
        }

        .btn-delete {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(244, 67, 54, 0.2);
        }

        .btn-delete:hover {
            background-color: var(--danger-color);
            color: white;
            border-color: var(--danger-color);
        }

        .btn-view {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
            border: 1px solid rgba(67, 97, 238, 0.2);
        }

        .btn-view:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
        }

        .empty-state-icon {
            font-size: 60px;
            color: #e0e0e0;
            margin-bottom: 20px;
        }

        /* Modal Styles */
        .modal-content {
            border-radius: var(--border-radius);
            border: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            border-bottom: 1px solid #eee;
            padding: 20px 30px;
        }

        .modal-body {
            padding: 30px;
        }

        .modal-footer {
            border-top: 1px solid #eee;
            padding: 20px 30px;
        }

        .form-label {
            font-weight: 500;
            color: var(--dark-color);
            margin-bottom: 8px;
        }

        .form-control, .form-select {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px 15px;
            transition: var(--transition);
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .form-text {
            font-size: 12px;
            color: var(--gray-color);
            margin-top: 5px;
        }

        .option-input-group {
            margin-bottom: 15px;
        }

        .option-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .correct-badge {
            background: var(--success-color);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
        }

        .explanation-box {
            background: #f8f9fa;
            border-left: 3px solid var(--primary-color);
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin-top: 10px;
        }

        .explanation-label {
            font-weight: 500;
            color: var(--dark-color);
            margin-bottom: 5px;
        }

        /* Pagination */
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .pagination-info {
            color: var(--gray-color);
            font-size: 14px;
        }

        .pagination {
            margin: 0;
        }

        .page-link {
            border: none;
            color: var(--gray-color);
            padding: 8px 15px;
            border-radius: 6px;
            margin: 0 3px;
            transition: var(--transition);
        }

        .page-link:hover {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }

        .page-item.active .page-link {
            background-color: var(--primary-color);
            color: white;
        }

        /* Toggle Switch */
        .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        /* Responsive Adjustments */
        @media (max-width: 992px) {
            .main-content {
                margin-left: 0;
            }

            .topbar-left h3 {
                font-size: 1.2rem;
            }

            .search-bar input {
                width: 180px;
            }

            .table-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .table-actions {
                width: 100%;
                justify-content: flex-end;
            }

            .modal-dialog {
                margin: 10px;
            }
        }

        @media (max-width: 768px) {
            .search-bar input {
                width: 150px;
            }

            .stats-card {
                margin-bottom: 15px;
            }

            .action-buttons {
                flex-direction: column;
            }
        }

        /* Mobile Menu Toggle */
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--dark-color);
            cursor: pointer;
        }

        @media (max-width: 992px) {
            .menu-toggle {
                display: block;
            }
        }

        /* MCQ Preview Card */
        .mcq-preview-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border: 2px dashed #ddd;
        }

        .preview-option {
            padding: 10px 15px;
            margin-bottom: 8px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
            transition: var(--transition);
        }

        .preview-option.correct {
            background: rgba(76, 175, 80, 0.1);
            border-color: var(--success-color);
        }

        .char-count {
            font-size: 12px;
            color: var(--gray-color);
            text-align: right;
            margin-top: 5px;
        }

        .char-count.warning {
            color: var(--warning-color);
        }

        .char-count.danger {
            color: var(--danger-color);
        }
    </style>
</head>

<body>
    <!-- Add MCQ Modal -->
    <div class="modal fade" id="addMCQModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New MCQ Question</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form method="POST" action="{% url 'add_mcq' %}" id="mcqForm">
                    {% csrf_token %}
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="course" class="form-label">Select Course *</label>
                                <select class="form-select" id="course" name="course" required>
                                    <option value="">Choose a course...</option>
                                    {% for course in courses %}
                                    <option value="{{ course.id }}">{{ course.title }}</option>
                                    {% endfor %}
                                </select>
                                <div class="form-text">Select the course for this MCQ</div>
                            </div>
                            
                            <div class="col-md-12 mb-3">
                                <label for="question_text" class="form-label">Question *</label>
                                <textarea class="form-control" id="question_text" name="question_text" 
                                          rows="3" placeholder="Enter the question..." required></textarea>
                                <div class="char-count" id="questionCount">0 characters</div>
                            </div>
                            
                            <div class="col-md-12 mb-3">
                                <div class="option-input-group">
                                    <div class="option-header">
                                        <label class="form-label">Option A *</label>
                                        <span class="correct-badge" id="correctOptionA" style="display: none;">Correct Answer</span>
                                    </div>
                                    <input type="text" class="form-control" id="option_a" name="option_a" 
                                           placeholder="Enter option A" required>
                                </div>
                                
                                <div class="option-input-group">
                                    <div class="option-header">
                                        <label class="form-label">Option B *</label>
                                        <span class="correct-badge" id="correctOptionB" style="display: none;">Correct Answer</span>
                                    </div>
                                    <input type="text" class="form-control" id="option_b" name="option_b" 
                                           placeholder="Enter option B" required>
                                </div>
                                
                                <div class="option-input-group">
                                    <div class="option-header">
                                        <label class="form-label">Option C *</label>
                                        <span class="correct-badge" id="correctOptionC" style="display: none;">Correct Answer</span>
                                    </div>
                                    <input type="text" class="form-control" id="option_c" name="option_c" 
                                           placeholder="Enter option C" required>
                                </div>
                                
                                <div class="option-input-group">
                                    <div class="option-header">
                                        <label class="form-label">Option D *</label>
                                        <span class="correct-badge" id="correctOptionD" style="display: none;">Correct Answer</span>
                                    </div>
                                    <input type="text" class="form-control" id="option_d" name="option_d" 
                                           placeholder="Enter option D" required>
                                </div>
                            </div>
                            
                            <div class="col-md-12 mb-3">
                                <label for="correct_option" class="form-label">Correct Answer *</label>
                                <div class="row">
                                    <div class="col-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="correct_option" 
                                                   id="correctA" value="A" required>
                                            <label class="form-check-label" for="correctA">
                                                Option A
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="correct_option" 
                                                   id="correctB" value="B">
                                            <label class="form-check-label" for="correctB">
                                                Option B
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="correct_option" 
                                                   id="correctC" value="C">
                                            <label class="form-check-label" for="correctC">
                                                Option C
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="correct_option" 
                                                   id="correctD" value="D">
                                            <label class="form-check-label" for="correctD">
                                                Option D
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-12 mb-3">
                                <label for="explanation" class="form-label">Explanation (Optional)</label>
                                <textarea class="form-control" id="explanation" name="explanation" 
                                          rows="3" placeholder="Explain why this is the correct answer..."></textarea>
                                <div class="form-text">Optional: Provide explanation for the correct answer</div>
                            </div>
                        </div>
                        
                        <!-- Preview Section -->
                        <div class="mcq-preview-card" id="previewSection">
                            <h6 class="mb-3">Preview</h6>
                            <div class="mcq-question" id="previewQuestion">Question will appear here...</div>
                            <div class="mcq-options">
                                <div class="preview-option" id="previewOptionA">
                                    <strong>A.</strong> <span>Option A preview</span>
                                </div>
                                <div class="preview-option" id="previewOptionB">
                                    <strong>B.</strong> <span>Option B preview</span>
                                </div>
                                <div class="preview-option" id="previewOptionC">
                                    <strong>C.</strong> <span>Option C preview</span>
                                </div>
                                <div class="preview-option" id="previewOptionD">
                                    <strong>D.</strong> <span>Option D preview</span>
                                </div>
                            </div>
                            <div class="explanation-box mt-3" id="previewExplanation" style="display: none;">
                                <div class="explanation-label">Explanation:</div>
                                <div id="previewExplanationText">Explanation will appear here...</div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-plus-circle"></i> Add MCQ
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View MCQ Modal -->
    <div class="modal fade" id="viewMCQModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">MCQ Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <label class="form-label">Course</label>
                            <div class="form-control" id="viewCourse"></div>
                        </div>
                        
                        <div class="col-md-12 mb-3">
                            <label class="form-label">Question</label>
                            <div class="form-control" style="min-height: 80px; background: #f8f9fa;" id="viewQuestion"></div>
                        </div>
                        
                        <div class="col-md-12 mb-3">
                            <label class="form-label">Options</label>
                            <div class="mcq-options">
                                <div class="preview-option" id="viewOptionA">
                                    <strong>A.</strong> <span></span>
                                </div>
                                <div class="preview-option" id="viewOptionB">
                                    <strong>B.</strong> <span></span>
                                </div>
                                <div class="preview-option" id="viewOptionC">
                                    <strong>C.</strong> <span></span>
                                </div>
                                <div class="preview-option" id="viewOptionD">
                                    <strong>D.</strong> <span></span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-12 mb-3">
                            <label class="form-label">Correct Answer</label>
                            <div class="form-control" id="viewCorrectAnswer"></div>
                        </div>
                        
                        <div class="col-md-12 mb-3">
                            <label class="form-label">Explanation</label>
                            <div class="form-control" style="min-height: 80px; background: #f8f9fa;" id="viewExplanation"></div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Created</label>
                            <div class="form-control" id="viewCreated"></div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Last Updated</label>
                            <div class="form-control" id="viewUpdated"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Navbar -->
        <div class="topbar">
            <div class="topbar-left">
                <button class="menu-toggle" id="menuToggle">
                    <i class="bi bi-list"></i>
                </button>
                <h3>MCQ Management</h3>
            </div>

            <div class="topbar-right">
                <div class="search-bar">
                    <i class="bi bi-search"></i>
                    <input type="text" placeholder="Search MCQs..." id="searchInput">
                </div>

                <div class="user-profile">
                    <div class="user-avatar">
                        <i class="bi bi-person"></i>
                    </div>
                    <div>
                        <h6 class="mb-0">Admin</h6>
                        <small class="text-muted">MCQ Manager</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page Header -->
        <div class="page-header">
            <div class="page-title">
                <h1>MCQ Questions</h1>
                <p>Manage multiple choice questions for your courses</p>
            </div>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMCQModal">
                <i class="bi bi-plus-circle"></i> Add New MCQ
            </button>
        </div>

        <!-- Stats Cards -->
        <div class="row mb-4">
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="stats-card blue">
                    <div class="stats-icon">
                        <i class="bi bi-question-circle"></i>
                    </div>
                    <div class="stats-content">
                        <h3>{{ total_mcqs }}</h3>
                        <p>Total MCQs</p>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="stats-card green">
                    <div class="stats-icon">
                        <i class="bi bi-journal-bookmark"></i>
                    </div>
                    <div class="stats-content">
                        <h3>{{ total_courses }}</h3>
                        <p>Courses with MCQs</p>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="stats-card orange">
                    <div class="stats-icon">
                        <i class="bi bi-check-circle"></i>
                    </div>
                    <div class="stats-content">
                        <h3>{{ mcqs_today }}</h3>
                        <p>Added Today</p>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="stats-card purple">
                    <div class="stats-icon">
                        <i class="bi bi-pencil-square"></i>
                    </div>
                    <div class="stats-content">
                        <h3>{{ mcqs_with_explanation }}</h3>
                        <p>With Explanation</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- MCQ Table -->
        <div class="table-container">
            <div class="table-header">
                <h5>MCQ List ({{ mcqs|length }} questions found)</h5>
                <div class="table-actions">
                    <select class="form-select form-select-sm" id="filterCourse" style="width: auto;">
                        <option value="">All Courses</option>
                        {% for course in courses %}
                        <option value="{{ course.id }}">{{ course.title|truncatechars:30 }}</option>
                        {% endfor %}
                    </select>
                    <select class="form-select form-select-sm" id="sortMCQs" style="width: auto;">
                        <option value="newest">Newest First</option>
                        <option value="oldest">Oldest First</option>
                        <option value="course">Course A-Z</option>
                    </select>
                </div>
            </div>

            <div class="table-responsive">
                {% if mcqs %}
                <table class="mcq-table" id="mcqsTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Question</th>
                            <th>Course</th>
                            <th>Correct Answer</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for mcq in mcqs %}
                        <tr class="mcq-row" data-course="{{ mcq.course.id }}" data-course-name="{{ mcq.course.title }}" 
                            data-question="{{ mcq.question_text|lower }}" data-created="{{ mcq.id }}">
                            <td><strong>{{ forloop.counter }}</strong></td>
                            <td>
                                <div class="mcq-question" title="{{ mcq.question_text }}">
                                    {{ mcq.question_text|truncatechars:100 }}
                                </div>
                                <div class="mcq-options">
                                    <div class="mcq-option">
                                        <span class="option-letter {% if mcq.correct_option == 'A' %}correct{% endif %}">A</span>
                                        <span>{{ mcq.option_a|truncatechars:40 }}</span>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="mcq-course">{{ mcq.course.title|truncatechars:30 }}</div>
                                <div class="mcq-course-info">
                                    <small>{{ mcq.course.instructor }}</small>
                                </div>
                            </td>
                            <td>
                                <div class="mcq-options">
                                    <div class="mcq-option">
                                        <span class="option-letter correct">{{ mcq.correct_option }}</span>
                                        <span>
                                            {% if mcq.correct_option == 'A' %}{{ mcq.option_a|truncatechars:30 }}
                                            {% elif mcq.correct_option == 'B' %}{{ mcq.option_b|truncatechars:30 }}
                                            {% elif mcq.correct_option == 'C' %}{{ mcq.option_c|truncatechars:30 }}
                                            {% elif mcq.correct_option == 'D' %}{{ mcq.option_d|truncatechars:30 }}
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>
                                {% if mcq.explanation %}
                                <small class="text-success"><i class="bi bi-info-circle"></i> Has explanation</small>
                                {% endif %}
                            </td>
                            <td>
                                <div class="mcq-created">
                                    {{ mcq.id|date:"M d, Y" }}
                                </div>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <a class="btn btn-action btn-view">
                                        <i class="bi bi-eye"></i> View
                                    </a>
                                    <a href="{% url 'edit_mcq' mcq.id %}" class="btn btn-action btn-edit">
                                        <i class="bi bi-pencil"></i> Edit
                                    </a>
                                    <a href="{% url 'delete_mcq' mcq.id %}" onclick="return confirm('Are you sure you want to delete this MCQ?')" class="btn btn-action btn-delete">
                                        <i class="bi bi-trash"></i> Delete
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="bi bi-question-circle"></i>
                    </div>
                    <h4>No MCQ Questions Found</h4>
                    <p class="text-muted">There are no MCQ questions available at the moment.</p>
                    <button type="button" class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#addMCQModal">
                        <i class="bi bi-plus-circle"></i> Add Your First MCQ
                    </button>
                </div>
                {% endif %}
            </div>

            {% if mcqs %}
            <!-- Pagination -->
            <div class="pagination-container">
                <div class="pagination-info">
                    Showing {{ mcqs|length }} of {{ total_mcqs }} MCQs
                </div>
                <nav>
                    <ul class="pagination pagination-sm mb-0">
                        {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page=1">
                                <i class="bi bi-chevron-double-left"></i>
                            </a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">
                                <i class="bi bi-chevron-left"></i>
                            </a>
                        </li>
                        {% else %}
                        <li class="page-item disabled">
                            <a class="page-link" href="#">
                                <i class="bi bi-chevron-left"></i>
                            </a>
                        </li>
                        {% endif %}
                        
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        
                        {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.next_page_number }}">
                                <i class="bi bi-chevron-right"></i>
                            </a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">
                                <i class="bi bi-chevron-double-right"></i>
                            </a>
                        </li>
                        {% else %}
                        <li class="page-item disabled">
                            <a class="page-link" href="#">
                                <i class="bi bi-chevron-right"></i>
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery for AJAX -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        // Mobile menu toggle
        document.getElementById('menuToggle').addEventListener('click', function () {
            document.querySelector('.sidebar').classList.toggle('active');
        });

        // Search functionality
        document.getElementById('searchInput').addEventListener('keyup', function () {
            const searchTerm = this.value.toLowerCase();
            const rows = document.querySelectorAll('.mcq-row');
            let visibleCount = 0;

            rows.forEach(row => {
                const question = row.getAttribute('data-question');
                const courseName = row.getAttribute('data-course-name').toLowerCase();

                if (question.includes(searchTerm) || courseName.includes(searchTerm)) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });

            // Update MCQ count
            document.querySelector('.table-header h5').textContent = `MCQ List (${visibleCount} questions found)`;
        });

        // Filter by course
        document.getElementById('filterCourse').addEventListener('change', function () {
            const selectedCourse = this.value;
            const rows = document.querySelectorAll('.mcq-row');
            let visibleCount = 0;

            rows.forEach(row => {
                const course = row.getAttribute('data-course');

                if (!selectedCourse || course === selectedCourse) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });

            document.querySelector('.table-header h5').textContent = `MCQ List (${visibleCount} questions found)`;
        });

        // Sort MCQs
        document.getElementById('sortMCQs').addEventListener('change', function () {
            const sortBy = this.value;
            const table = document.getElementById('mcqsTable');
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('.mcq-row'));

            rows.sort((a, b) => {
                switch (sortBy) {
                    case 'newest':
                        return parseInt(b.getAttribute('data-created')) - parseInt(a.getAttribute('data-created'));
                    case 'oldest':
                        return parseInt(a.getAttribute('data-created')) - parseInt(b.getAttribute('data-created'));
                    case 'course':
                        const courseA = a.getAttribute('data-course-name').toLowerCase();
                        const courseB = b.getAttribute('data-course-name').toLowerCase();
                        return courseA.localeCompare(courseB);
                    default:
                        return 0;
                }
            });

            // Reorder rows in the table
            rows.forEach(row => tbody.appendChild(row));

            // Update row numbers
            const visibleRows = tbody.querySelectorAll('.mcq-row:not([style*="display: none"])');
            visibleRows.forEach((row, index) => {
                row.querySelector('td strong').textContent = index + 1;
            });
        });

        // Question character count
        const questionInput = document.getElementById('question_text');
        const questionCount = document.getElementById('questionCount');
        
        questionInput.addEventListener('input', function() {
            const count = this.value.length;
            questionCount.textContent = `${count} characters`;
            updatePreview();
        });

        // Option inputs live update
        const optionInputs = ['option_a', 'option_b', 'option_c', 'option_d'];
        optionInputs.forEach(id => {
            document.getElementById(id).addEventListener('input', updatePreview);
        });

        // Correct option radio buttons
        const correctOptionRadios = document.querySelectorAll('input[name="correct_option"]');
        correctOptionRadios.forEach(radio => {
            radio.addEventListener('change', updatePreview);
        });

        // Explanation input
        document.getElementById('explanation').addEventListener('input', updatePreview);

        // Update preview function
        function updatePreview() {
            // Update question preview
            const questionText = document.getElementById('question_text').value;
            document.getElementById('previewQuestion').textContent = 
                questionText || 'Question will appear here...';

            // Update option previews
            optionInputs.forEach((id, index) => {
                const optionText = document.getElementById(id).value;
                const optionLetter = String.fromCharCode(65 + index);
                const previewElement = document.getElementById(`previewOption${optionLetter}`);
                
                if (optionText) {
                    previewElement.querySelector('span').textContent = optionText;
                    previewElement.style.display = 'flex';
                } else {
                    previewElement.querySelector('span').textContent = `Option ${optionLetter} preview`;
                    previewElement.style.display = 'flex';
                }
            });

            // Update correct answer highlight
            const selectedCorrect = document.querySelector('input[name="correct_option"]:checked');
            if (selectedCorrect) {
                const correctLetter = selectedCorrect.value;
                
                // Remove correct class from all options
                optionInputs.forEach((id, index) => {
                    const optionLetter = String.fromCharCode(65 + index);
                    const previewElement = document.getElementById(`previewOption${optionLetter}`);
                    previewElement.classList.remove('correct');
                    document.getElementById(`correctOption${optionLetter}`).style.display = 'none';
                });
                
                // Add correct class to selected option
                const correctPreview = document.getElementById(`previewOption${correctLetter}`);
                correctPreview.classList.add('correct');
                document.getElementById(`correctOption${correctLetter}`).style.display = 'inline';
            }

            // Update explanation preview
            const explanationText = document.getElementById('explanation').value;
            const explanationBox = document.getElementById('previewExplanation');
            if (explanationText) {
                document.getElementById('previewExplanationText').textContent = explanationText;
                explanationBox.style.display = 'block';
            } else {
                explanationBox.style.display = 'none';
            }
        }

        // View MCQ details (you would typically fetch this via AJAX)
        function viewMCQ(mcqId) {
            // This is a mock function. In real implementation, you would fetch data via AJAX
            // For now, we'll just show the modal with sample data
            const modal = new bootstrap.Modal(document.getElementById('viewMCQModal'));
            
            // In real implementation, fetch data via AJAX:
            // fetch(`/api/mcq/${mcqId}/`)
            //     .then(response => response.json())
            //     .then(data => {
            //         document.getElementById('viewCourse').textContent = data.course_title;
            //         document.getElementById('viewQuestion').textContent = data.question_text;
            //         document.getElementById('viewOptionA').querySelector('span').textContent = data.option_a;
            //         document.getElementById('viewOptionB').querySelector('span').textContent = data.option_b;
            //         document.getElementById('viewOptionC').querySelector('span').textContent = data.option_c;
            //         document.getElementById('viewOptionD').querySelector('span').textContent = data.option_d;
            //         document.getElementById('viewCorrectAnswer').textContent = `Option ${data.correct_option}: ${getCorrectOptionText(data)}`;
            //         document.getElementById('viewExplanation').textContent = data.explanation || 'No explanation provided';
            //         document.getElementById('viewCreated').textContent = data.created_at;
            //         document.getElementById('viewUpdated').textContent = data.updated_at;
            //         modal.show();
            //     });
            
            // For demo, we'll use static data
            document.getElementById('viewCourse').textContent = 'Sample Course';
            document.getElementById('viewQuestion').textContent = 'Sample question text?';
            document.getElementById('viewOptionA').querySelector('span').textContent = 'Option A text';
            document.getElementById('viewOptionB').querySelector('span').textContent = 'Option B text';
            document.getElementById('viewOptionC').querySelector('span').textContent = 'Option C text';
            document.getElementById('viewOptionD').querySelector('span').textContent = 'Option D text';
            document.getElementById('viewCorrectAnswer').textContent = 'Option B: Option B text';
            document.getElementById('viewExplanation').textContent = 'This is a sample explanation for why option B is correct.';
            document.getElementById('viewCreated').textContent = 'Jan 15, 2024';
            document.getElementById('viewUpdated').textContent = 'Jan 15, 2024';
            
            modal.show();
        }

        function getCorrectOptionText(data) {
            switch(data.correct_option) {
                case 'A': return data.option_a;
                case 'B': return data.option_b;
                case 'C': return data.option_c;
                case 'D': return data.option_d;
                default: return '';
            }
        }

        // Form validation
        document.getElementById('mcqForm').addEventListener('submit', function(e) {
            const course = document.getElementById('course').value;
            const question = document.getElementById('question_text').value.trim();
            const optionA = document.getElementById('option_a').value.trim();
            const optionB = document.getElementById('option_b').value.trim();
            const optionC = document.getElementById('option_c').value.trim();
            const optionD = document.getElementById('option_d').value.trim();
            const correctOption = document.querySelector('input[name="correct_option"]:checked');

            if (!course) {
                e.preventDefault();
                alert('Please select a course');
                document.getElementById('course').focus();
                return false;
            }

            if (!question) {
                e.preventDefault();
                alert('Please enter the question');
                document.getElementById('question_text').focus();
                return false;
            }

            if (!optionA || !optionB || !optionC || !optionD) {
                e.preventDefault();
                alert('Please fill in all options');
                return false;
            }

            if (!correctOption) {
                e.preventDefault();
                alert('Please select the correct answer');
                return false;
            }

            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Adding MCQ...';
            submitBtn.disabled = true;

            return true;
        });

        // Initialize preview on page load
        document.addEventListener('DOMContentLoaded', function() {
            updatePreview();
            
            // Add hover effect to table rows
            const tableRows = document.querySelectorAll('.mcq-row');
            tableRows.forEach(row => {
                row.addEventListener('mouseenter', function () {
                    this.style.transform = 'translateY(-2px)';
                });

                row.addEventListener('mouseleave', function () {
                    this.style.transform = 'translateY(0)';
                });
            });
        });

        // Reset form when modal is closed
        document.getElementById('addMCQModal').addEventListener('hidden.bs.modal', function () {
            document.getElementById('mcqForm').reset();
            updatePreview();
        });
    </script>
    {% endblock %}
</body>
</html>