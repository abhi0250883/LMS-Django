{% extends './admin_sidebar.html' %}
{% block content %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Create Coupon</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .admin-content {
            margin-left: 260px;
            padding: 30px;
            position: relative;
            z-index: 10;
        }

        /* Card ko upar rakhne ke liye */
        .card {
            position: relative;
            z-index: 20;
        }


        .dropdown-menu {
            position: absolute !important;
            z-index: 9999 !important;
        }

        .bg-light {
            position: relative;
            z-index: 9999 !important;
            overflow: visible !important;
        }

        /* Container with very high z-index */
        .container.mt-5 {
            position: relative !important;
            z-index: 10000 !important;
            margin-left: auto;
            margin-right: auto;
            transform: translateZ(0);
            /* Force hardware acceleration */
        }

        /* Card with even higher z-index */
        .card.shadow {
            position: relative !important;
            z-index: 10001 !important;
            background-color: white;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.15) !important;
        }

        /* Fix for dropdowns */
        .multi-select-dropdown {
            position: relative;
            z-index: 10002 !important;
        }

        .multi-select-dropdown .dropdown-menu {
            max-height: 250px;
            overflow-y: auto;
            width: 100%;
            z-index: 10003 !important;
            position: absolute !important;
        }

        .multi-select-dropdown label {
            width: 100%;
            cursor: pointer;
        }

        /* Ensure all form elements are visible */
        .form-control,
        .btn,
        .dropdown-toggle {
            position: relative;
            z-index: 10004 !important;
        }

        /* Override any parent styles */
        body>div:not(.sidebar) {
            position: relative;
            z-index: 1;
        }

        /* Alternative: Use transform to create new stacking context */
        .content-wrapper {
            transform: translate3d(0, 0, 0);
            position: relative;
            z-index: 9999;
        }
    </style>
</head>

<body class="bg-light">
    <div class="admin-content">
        <div class="content-wrapper">
            <div class="container mt-5" style="position: relative; z-index: 10000 !important;">
                <div class="card shadow" style="position: relative; z-index: 10001 !important;">
                    <div class="card-header bg-primary text-white">
                        <h4>Create New Coupon</h4>
                    </div>

                    <div class="card-body" style="position: relative; z-index: 10002 !important;">
                        <form method="POST">
                            {% csrf_token %}

                            <div class="mb-3">
                                <label class="form-label">Coupon Code</label>
                                <input type="text" name="code" class="form-control" required
                                    placeholder="e.g. NEWUSER50" style="position: relative; z-index: 10003;">
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Discount Type</label>
                                <select name="discount_type" class="form-control" required
                                    style="position: relative; z-index: 10003;">
                                    <option value="percent">Percentage (%)</option>
                                    <option value="flat">Flat Amount (â‚¹)</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Discount Value</label>
                                <input type="number" name="discount_value" class="form-control" required
                                    placeholder="e.g. 20" style="position: relative; z-index: 10003;">
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Minimum Order Amount</label>
                                <input type="number" name="min_amount" class="form-control" value="0"
                                    style="position: relative; z-index: 10003;">
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Expiry Date</label>
                                <input type="date" name="expiry_date" class="form-control"
                                    style="position: relative; z-index: 10003;">
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Max Uses Per User</label>
                                <input type="number" name="max_uses_per_user" class="form-control" placeholder="e.g. 1"
                                    style="position: relative; z-index: 10003;">
                            </div>


                            <div class="mb-3 multi-select-dropdown"
                                style="position: relative; z-index: 10004 !important;">

                                <label class="form-label">Select Courses</label>

                                <!-- Button where selected items will show -->
                                <button id="selectedCoursesBtn" class="btn btn-outline-secondary w-100 dropdown-toggle"
                                    type="button" data-bs-toggle="dropdown" aria-expanded="false"
                                    style="position: relative; z-index: 10005;">
                                    Choose Courses
                                </button>

                                <ul class="dropdown-menu" style="z-index: 10006 !important; position: absolute;">
                                    {% for course in courses %}
                                    <li class="dropdown-item">
                                        <label>
                                            <input type="checkbox" class="course-checkbox" value="{{ course.id }}"
                                                data-name="{{ course.title }}">
                                            {{ course.title }}
                                        </label>
                                    </li>
                                    {% endfor %}
                                </ul>

                                <!-- Hidden input to store selected course IDs -->
                                <input type="hidden" name="courses" id="selectedCoursesInput">

                            </div>



                            <button class="btn btn-success w-100" style="position: relative; z-index: 10003;">Create
                                Coupon</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Update button text when courses are selected
        document.addEventListener("DOMContentLoaded", function () {
            const checkboxes = document.querySelectorAll(".course-checkbox");
            const btn = document.getElementById("selectedCoursesBtn");
            const hiddenInput = document.getElementById("selectedCoursesInput");

            checkboxes.forEach(cb => {
                cb.addEventListener("change", function () {
                    let selectedNames = [];
                    let selectedIds = [];

                    checkboxes.forEach(item => {
                        if (item.checked) {
                            selectedNames.push(item.getAttribute("data-name"));
                            selectedIds.push(item.value);
                        }
                    });

                    if (selectedNames.length > 0) {
                        btn.innerHTML = "Selected: " + selectedNames.join(", ");
                    } else {
                        btn.innerHTML = "Choose Courses";
                    }

                    // Update hidden input with selected IDs
                    hiddenInput.value = selectedIds.join(',');
                });
            });

            // Force form to be on top
            document.querySelector('.card.shadow').style.transform = 'translate3d(0,0,0)';
        });

        // Additional JavaScript to ensure form stays on top
        window.addEventListener('load', function () {
            // Remove any parent overflow:hidden that might be causing issues
            const parents = document.querySelectorAll('.bg-light, .container, .card');
            parents.forEach(parent => {
                parent.style.overflow = 'visible';
            });

            // Force a reflow to ensure z-index is applied
            document.body.offsetHeight;
        });
    </script>
</body>

</html>
{% endblock %}